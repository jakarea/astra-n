I cloud not understand why your fixing 1 issue, creating 3 issues, fixing 3 issue creating 9 issues Login should be very simple, if login success set browser session and something so you can detect the user is loggedin, and store token in session, when need to connect with database you will use that token from session, if browser session and session/token is missing destroy all sesson and redirect to login page, if any user  go into login page he will be checked browser session and sesson token to check if already loggedin, if detect already loggedin in both browser and session token set, then redirect to dashboard, if any of this missing destroy all session and redirect to login for all router, but need to check only guest user can see login page, never loggedout user rederect to logi page to login page infinit loop, let me know what you understod, now you can remove previous all middleware and rewrite auth from scretch